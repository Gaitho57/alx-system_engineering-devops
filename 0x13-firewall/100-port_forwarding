#!/usr/bin/env bash

# Update system packages
sudo apt-get update

# Install ufw if not already installed
sudo apt-get install -y ufw

# Reset ufw to default settings
sudo ufw --force reset

# Configure ufw to enable port forwarding
sudo sed -i 's/#net\/ipv4\/ip_forward=1/net\/ipv4\/ip_forward=1/g' /etc/ufw/sysctl.conf

# Reload sysctl configuration
sudo sysctl -p /etc/ufw/sysctl.conf

# Configure port forwarding in ufw
sudo echo "*nat
:PREROUTING ACCEPT [0:0]
-A PREROUTING -p tcp --dport 8080 -j REDIRECT --to-port 80
COMMIT" | sudo tee /etc/ufw/before.rules > /dev/null

# Enable ufw
sudo ufw --force enable
